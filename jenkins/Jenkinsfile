node {
    checkout scm
    stage('node setup'){
        echo '--- start setup ---'
        sh 'echo $PATH'
        def nodeHome = tool 'node-10.1.0'
        env.PATH = '${env.PATH}:{$nodeHome}/bin'

        sh 'echo $PATH'
        def npmHome = tool 'npm-6.1.0'
        env.PATH = '${env.PATH}:{$nomHome}/bin'

        echo '--- finished setup ---'
        sh 'echo $PATH'
        sh 'node --version'
        sh 'npm --version'
    }
    stage('compile') {
        parallel(
            java: {
                sh './gradlew clean build'
            },
            npm: {
                sh './gradlew npmInstall'
            }
        )
    }
    stage('test') {
        parallel(
            jUnit: {
                sh './gradlew test'
            },
            jest: {
                sh './gradlew npmTest'
            }
        )
    }
    stage('build webapp') {
        sh './gradlew npmProd'
    }
    stage('deployment') {
        echo 'deployment'
    }
}