node {
    checkout scm
    stage('node setup'){
        env.NODEJS_HOME = "${tool 'Node 6.x'}"
        env.PATH="${env.NODEJS_HOME}/bin:${env.PATH}"
        sh 'node --version'
        sh 'npm --version'
    }
    stage('compile') {
        parallel(
            java: {
                sh './gradlew clean build'
            },
            npm: {
                sh './gradlew npmInstall'
            }
        )
    }
    stage('test') {
        parallel(
            jUnit: {
                sh './gradlew test'
            },
            jest: {
                sh './gradlew npmTest'
            }
        )
    }
    stage('build webapp') {
        sh './gradlew npmProd'
    }
    stage('deployment') {
        echo 'deployment'
    }
}