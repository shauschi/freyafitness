node {
    checkout scm
    stage('node setup'){
        env.NODEJS_HOME = tool name: 'Node 10.4.1', type: 'jenkins.plugins.nodejs.tools.NodeJSInstallation'
        env.PATH="${env.NODEJS_HOME}/bin:${env.PATH}"
        sh 'echo $PATH'
        sh 'node --version'
        sh 'npm --version'
    }
    stage('compile') {
        parallel(
            java: {
                sh './gradlew clean build'
            },
            npm: {
                sh './gradlew npmInstall'
            }
        )
    }
    stage('test') {
        parallel(
            jUnit: {
                sh './gradlew test'
            },
            jest: {
                sh './gradlew npmTest'
            }
        )
    }
    stage('build webapp') {
        sh './gradlew npmProd'
    }
    stage('deployment') {
        echo 'deployment'
    }
}